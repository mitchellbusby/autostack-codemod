<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Code Step Highlighter</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #2d2d2d;
      color: #ccc;
      font-family: sans-serif;
      padding: 2rem;
    }
    pre {
      position: relative;
      font-size: 1.1rem;
    }
    code span.highlight {
      background-color: #44475a;
      border-left: 4px solid #50fa7b;
      display: block;
      padding-left: 0.5em;
    }
    code span.line {
      display: block;
    }
  </style>
</head>
<body>
  <h1>Code Step Highlighter</h1>
  <p>Press the <strong>space bar</strong> to step forward, or <strong>Shift + Space</strong> to go back.</p>

  <pre><code class="language-javascript" id="code-block"></code></pre>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const codeBlock = document.getElementById('code-block');

      const codeLines = [
        '/**',
        ' * A codemod to add autoStack={false} to existing Popover/OptionMenu/Select/Tooltip usages without',
        ' * autoStack on them.',
        ' */',
        'export const parser = "tsx";',
        '',
        'export default function (file, api) {',
        '  /**',
        '   * Don\'t try to run over anything in the codemods folder.',
        '   */',
        '  if (file.path.includes("codemods")) {',
        '    return null;',
        '  }',
        '',
        '  const j = api.jscodeshift;',
        '  const root = j(file.source);',
        '',
        '  let fixedProps = false;',
        '',
        '  root',
        '    .find(j.JSXElement, {',
        '      openingElement: {',
        '        name: (node) =>',
        '          node.type === "JSXIdentifier" && ["OptionMenu", "Select", "Tooltip", "Popover"].includes(node.name),',
        '      },',
        '    })',
        '    .forEach((path) => {',
        '      // If autoStack is missing, set it to false',
        '      const autoStackAttribute = path.node.openingElement.attributes.find((attr) => attr.name?.name === "autoStack");',
        '      if (!autoStackAttribute) {',
        '        console.log(`Missing autostack in ${file.path}, fixing it`);',
        '        path.node.openingElement.attributes.push(',
        '          j.jsxAttribute(j.jsxIdentifier("autoStack"), j.jsxExpressionContainer(j.booleanLiteral(false))),',
        '        );',
        '        fixedProps = true;',
        '      }',
        '    });',
        '',
        '  if (!fixedProps) {',
        '    return null;',
        '  }',
        '',
        '  return root.toSource({ reuseWhitespace: true, wrapColumn: 0 });',
        '}'
      ];

      const stepGroups = [
        [0, 1, 2, 3],
        [4],
        [6, 7, 8, 9],
        [10, 11, 12],
        [14, 15],
        [17],
        [19, 20, 21, 22, 23, 24],
        [25, 26, 27, 28, 29, 30],
        [32, 33],
        [35]
      ];

      const spanElements = codeLines.map((line, i) => {
        const span = document.createElement('span');
        span.classList.add('line');
        span.dataset.line = i;
        span.innerHTML = Prism.highlight(line, Prism.languages.javascript, 'javascript');
        return span;
      });

      spanElements.forEach(span => codeBlock.appendChild(span));

      let currentStep = -1;

      function highlightStep(step) {
        spanElements.forEach(span => span.classList.remove('highlight'));
        if (stepGroups[step]) {
          stepGroups[step].forEach(i => {
            const el = spanElements[i];
            if (el) el.classList.add('highlight');
          });
        }
      }

      document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
          e.preventDefault();
          if (e.shiftKey) {
            currentStep = (currentStep - 1 + stepGroups.length) % stepGroups.length;
          } else {
            currentStep = (currentStep + 1) % stepGroups.length;
          }
          highlightStep(currentStep);
        }
      });

      highlightStep(currentStep);
    });
  </script>
</body>
</html>